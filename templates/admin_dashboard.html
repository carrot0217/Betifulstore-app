<!DOCTYPE html>
<form method="get" style="margin-bottom: 20px;">
  시작일: <input type="date" name="start" value="{{ start_date }}">
  종료일: <input type="date" name="end" value="{{ end_date }}">

  매장 선택:
  <select name="store">
    <option value="">전체 보기</option>
    {% for store in store_list %}
      <option value="{{ store }}" {% if store == selected_store %}selected{% endif %}>{{ store }}</option>
    {% endfor %}
  </select>

  품목 선택:
  <select name="item">
    <option value="">전체 보기</option>
    {% for item in item_list %}
      <option value="{{ item }}" {% if item == selected_item %}selected{% endif %}>{{ item }}</option>
    {% endfor %}
  </select>

  <button type="submit">조회</button>
</form>

<html>
<head>
  <title>관리자 통계 대시보드</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    body {
      font-family: "Segoe UI", sans-serif;
      background-color: #f9f5f0;
      padding: 30px;
      color: #333;
    }
    h1 {
      color: #444;
    }
    .stat-box {
      background: #fff3e6;
      padding: 15px;
      margin-bottom: 20px;
      border-radius: 8px;
      box-shadow: 0 0 5px rgba(0,0,0,0.05);
    }
    canvas {
      margin-top: 20px;
      background: #fff;
      padding: 10px;
      border-radius: 8px;
    }
    a {
      display: inline-block;
      margin-top: 30px;
      color: #336699;
    }
  </style>
</head>
<body>
  <h1>📊 관리자 통계 대시보드</h1>

  <div class="stat-box">
    <p><strong>총 주문 건수:</strong> {{ total_orders }}건</p>
    <p><strong>총 주문 수량:</strong> {{ total_quantity }}개</p>
  </div>

  <h3>🏬 매장별 주문 건수</h3>
  <canvas id="storeChart"></canvas>

  <h3>📦 상품별 누적 주문 수량</h3>
  <canvas id="itemChart"></canvas>

  <h3>📅 최근 7일 주문 추이</h3>
  <canvas id="dailyChart"></canvas>

  <h3>🏆 주문량 TOP 5 상품</h3>
  <canvas id="topChart"></canvas>

  <a href="/admin">← 관리자 페이지로 돌아가기</a>

  <script>
    const storeChart = new Chart(document.getElementById('storeChart'), {
      type: 'bar',
      data: {
        labels: {{ store_counts.keys() | list | tojson }},
        datasets: [{
          label: '매장별 주문 건수',
          data: {{ store_counts.values() | list | tojson }},
          backgroundColor: '#ffd6a5'
        }]
      }
    });

    const itemChart = new Chart(document.getElementById('itemChart'), {
      type: 'bar',
      data: {
        labels: {{ item_counts.keys() | list | tojson }},
        datasets: [{
          label: '상품별 주문 수량',
          data: {{ item_counts.values() | list | tojson }},
          backgroundColor: '#ffadad'
        }]
      }
    });

    const dailyChart = new Chart(document.getElementById('dailyChart'), {
      type: 'line',
      data: {
        labels: {{ recent_7_days | tojson }},
        datasets: [{
          label: '일별 주문 건수',
          data: {{ daily_data | tojson }},
          backgroundColor: 'rgba(173,216,230,0.4)',
          borderColor: '#74c0fc',
          fill: true
        }]
      }
    });

    const topChart = new Chart(document.getElementById('topChart'), {
      type: 'bar',
      data: {
        labels: {{ top_items | map(attribute=0) | list | tojson }},
        datasets: [{
          label: 'TOP 5 상품 주문 수량',
          data: {{ top_items | map(attribute=1) | list | tojson }},
          backgroundColor: '#b5ead7'
        }]
      }
    });
  </script>
</body>
</html>
